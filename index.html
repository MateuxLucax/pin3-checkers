<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkers</title>
  <style>
    :root {
      --cell-size-px: 36px;
      --white0: rgb(220, 220, 220);
      --black0: rgb(50, 50, 50);
      --white1: rgb(180, 180, 180);
      --black1: rgb(100, 100, 100);
    }
    .board-table, .board-cell, .board-row {
      border: 0;
      padding: 0;
      margin: 0;
    }
    .board-cell {
      width: var(--cell-size-px);
      height: var(--cell-size-px);
      max-width: var(--cell-size-px);
      max-height: var(--cell-size-px);
      position: relative;
    }
    .cell-text {
      position: absolute;
      top: 50%;
      left: 0;
      width: 100%;
      height: 100%;
      transform: translateY(-50%);
      color: white;
      text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
      opacity: 0.07;
      font-family: monospace;
      font-size: 13px;
    }
    .cell-text:hover {
      cursor: default;
      opacity: 0.8;
    }
    .board-cell.black {
      background-color: var(--black0);
    }
    .board-cell.white {
      background-color: var(--white0);
    }

    .piece {
      position: absolute;
    }

    .piece.man {
      top: 50%;
      left: 50%;
      transform: translateY(-50%) translateX(-50%);
      width: calc(3/4 * var(--cell-size-px));
      height: calc(3/4 * var(--cell-size-px));
      border-radius: 100%;
    }

    .piece.king {
      top: 50%;
      left: 50%;
      transform: translateY(-50%) translateX(-50%) rotate(45deg);
      width: calc(1/2 * var(--cell-size-px));
      height: calc(1/2 * var(--cell-size-px));
    }

    .piece.white {
      background-color: var(--white0);
      border: 2px solid var(--black1);
    }
    .piece.black {
      background-color: var(--black0);
      border: 2px solid var(--white1);
    }
  </style>
</head>
<body>

<table id="board-table"></table>

<div id="container1"></div>
<div id="container2" style="margin-top: 10px"></div>

<script type="module">
import { decodeBoard, fullMoveDo, fullMoveUndo } from './board.js'
import { createBoardTable, renderBoard } from './board-render.js'
import { getCaptureSequences } from './move-generation.js'

// some quick and dirty code just to test the functions

// TODO organize these tests, maybe
// TODO make the functions more robust (check if in bounds, move is diagonal etc. then throw when these conditions aren't met)

// test rendering
// const elemMatrix = createBoardTable(document.querySelector('#board-table'), false)
// renderBoard(makeInitialBoard(), elemMatrix)

// test getSingleCaptureDestinations
// const testBoard = decodeBoard([
//   '........',
//   '.x......',
//   '..@.....',
//   '.x......',
//   '....x...'
// ].join('\n'));
// renderBoard(testBoard, elemMatrix);
// console.log(getSingleCaptureDestinations(testBoard, { row: 2, col: 2 }));

// const testBoard = decodeBoard([
//   '........',
//   '........',
//   '........',
//   '..o.....',
//   '.....@..',
//   '......#.'
// ].join('\n'));

// test getSimpleMoveDestinations
// renderBoard(testBoard, elemMatrix);
// console.log({ row: 2, col: 2 }, getSimpleMoveDestinations(testBoard, { row: 2, col: 2 }));
// console.log({ row: 0, col: 4 }, getSimpleMoveDestinations(testBoard, { row: 0, col: 4 }));
// console.log({ row: 3, col: 1 }, getSimpleMoveDestinations(testBoard, { row: 3, col: 1 }));
// console.log({ row: 4, col: 4 }, getSimpleMoveDestinations(testBoard, { row: 4, col: 4 }));


// Test do/undo

//                     v source
// const moveSequence = [ {row: 5, col: 6}, {row: 2, col: 3}, {row: 4, col: 1} ]
// const moveInfoStack = []
// const tableContainer1 = document.querySelector('#container1')

// const table = document.createElement('table')
// table.style.display = 'inline'
// renderBoard(testBoard, createBoardTable(table))
// tableContainer1.append(table)

// for (let moveIdx = 1; moveIdx < moveSequence.length; moveIdx++) {
//   const from = moveSequence[moveIdx-1]
//   const to   = moveSequence[moveIdx]

//   const moveInfo = singleMoveDo(testBoard, from, to)
//   moveInfoStack.push(moveInfo)

//   const table = document.createElement('table')
//   table.style.display = 'inline'
//   table.style.marginLeft = '10px'
//   renderBoard(testBoard, createBoardTable(table))
//   tableContainer1.append(table)
// }

// const tableContainer2 = document.querySelector('#container2')

// for (let moveIdx = moveSequence.length-1; moveIdx >= 1; moveIdx--) {
//   const from = moveSequence[moveIdx-1]
//   const to   = moveSequence[moveIdx]
//   const moveInfo = moveInfoStack.pop()
//   singleMoveUndo(testBoard, from, to, moveInfo)

//   const table = document.createElement('table')
//   table.style.display = 'inline'
//   table.style.marginLeft = moveIdx == moveSequence.length-1 ? '' : '10px'
//   renderBoard(testBoard, createBoardTable(table))
//   tableContainer2.append(table)
// }

// Test getCaptureSequences

// http://www.damasciencias.com.br/regras-jogo-de-damas/tab10.gif
// const testBoard = decodeBoard([
//   '........',
//   '..x.x.x.',
//   '........',
//   '..x.x.x.',
//   '.......o',
// ].join('\n'))
// const caps = getCaptureSequences(testBoard, { row: 4, col: 7 })

// http://www.damasciencias.com.br/regras-jogo-de-damas/tab11.gif
const testBoard = decodeBoard([
  '.....#..',
  '........',
  '...o....',
  '........',
  '.....o..',
  '..o.....',
  '.....o..',
  '........',
].join('\n'))
let sequences = getCaptureSequences(testBoard, { row: 0, col: 5 })

// const elemMatrix = createBoardTable(document.querySelector('#board-table'))
// renderBoard(testBoard, elemMatrix)

// console.log(encodeBoard(testBoard))
// console.log(sequence)

// // should remain unchanged
// console.log(encodeBoard(testBoard))

const from = { row: 0, col: 5}
for (const sequence of sequences) {
  console.log(from, sequence)
  const tableRow = document.createElement('div')
  tableRow.style.marginTop = '10px'
  document.body.append(tableRow)

  const tableElem0 = document.createElement('table')
  tableElem0.style.display='inline'
  const elemMatrix0 = createBoardTable(tableElem0)
  renderBoard(testBoard, elemMatrix0)
  tableRow.append(tableElem0)

  const moveInfo = fullMoveDo(testBoard, from, sequence)

  const tableElem1 = document.createElement('table')
  tableElem1.style.display='inline'
  tableElem1.style.marginLeft = '10px'
  const elemMatrix1 = createBoardTable(tableElem1)
  renderBoard(testBoard, elemMatrix1)
  tableRow.append(tableElem1)

  fullMoveUndo(testBoard, from, sequence, moveInfo)

  const tableElem2 = document.createElement('table')
  tableElem2.style.display='inline'
  tableElem2.style.marginLeft = '10px'
  const elemMatrix2 = createBoardTable(tableElem2)
  renderBoard(testBoard, elemMatrix2)
  tableRow.append(tableElem2)
}

</script>

</body>
</html>